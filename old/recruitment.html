<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard Rekrutmen AQHSA SHOFIA</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <!-- Bootstrap CSS for tables and alerts (only necessary components) -->
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
    />
    <style>
      /* Base styles for the body and font (from Tailwind/Inter) */
      body {
        font-family: "Inter", sans-serif;
        background-color: #f4f5f8;
      }
      /* Sidebar width configuration */
      .sidebar {
        width: 256px;
        min-width: 256px;
      }
      /* Main content area to take remaining space */
      .content {
        flex-grow: 1;
      }
      /* Card styling for consistent UI elements */
      .card {
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1),
          0 2px 4px -1px rgba(0, 0, 0, 0.06);
        border-radius: 12px;
      }
      /* Tab navigation button styling */
      .tab-button {
        padding: 0.75rem 1.5rem;
        border-radius: 0.5rem;
        font-weight: 500;
        transition: all 0.2s ease-in-out;
        cursor: pointer;
        background-color: #e0e7ff; /* indigo-100 */
        color: #4338ca; /* indigo-700 */
      }
      .tab-button.active {
        background-color: #4f46e5; /* indigo-600 */
        color: white;
      }
      .tab-button:not(.active):hover {
        background-color: #c7d2fe; /* indigo-200 */
        color: #3730a3; /* indigo-800 */
      }
      /* Table specific styles (from Bootstrap, but adjusted for sticky header) */
      .table th,
      .table td {
        text-align: center;
        vertical-align: middle;
      }
      .table thead th {
        background-color: #f9fafb; /* bg-gray-50 */
        position: sticky;
        top: 0;
        z-index: 1;
      }
      .table-responsive {
        max-height: 500px; /* Adjust as needed for table height */
        overflow-y: auto;
        border: 1px solid #dee2e6;
        border-radius: 0.25rem;
      }
      /* Alert/Toast styling */
      .alert {
        display: none;
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 1050;
        min-width: 250px;
        text-align: center;
        box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
      }
      .btn-action {
        margin: 2px;
      }
      /* Mobile responsiveness for sidebar */
      #sidebar-backdrop {
        position: fixed;
        inset: 0;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 10;
        display: none; /* Hidden by default on larger screens */
      }
      @media (max-width: 1023px) {
        /* lg breakpoint in Tailwind is 1024px */
        .sidebar {
          transform: translateX(-100%);
          position: fixed;
          height: 100%;
          top: 0;
          left: 0;
        }
        .sidebar.translate-x-0 {
          transform: translateX(0);
        }
        #sidebar-backdrop.show {
          display: block;
        }
      }
    </style>
  </head>
  <body>
    <!-- Header Section -->
    <header
      class="bg-white shadow-sm py-4 px-6 flex items-center justify-between lg:justify-start lg:space-x-4 z-10 sticky top-0"
    >
      <!-- Sidebar toggle button for mobile views -->
      <button
        id="sidebar-toggle-btn"
        class="lg:hidden p-2 rounded-md text-gray-500 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-indigo-500"
      >
        <svg
          class="h-6 w-6"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M4 6h16M4 12h16M4 18h16"
          ></path>
        </svg>
      </button>
      <!-- Main title of the HRIS system -->
      <h1 class="text-2xl font-bold text-gray-800">AQHSA SHOFIA - HRIS</h1>
      <!-- User profile and notification icons -->
      <div class="flex items-center space-x-4 ml-auto">
        <svg
          class="h-6 w-6"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"
          ></path>
        </svg>
        <div class="relative">
          <img
            src="https://placehold.co/40x40/94a3b8/ffffff?text=U"
            alt="User"
            class="w-10 h-10 rounded-full cursor-pointer"
          />
        </div>
      </div>
    </header>

    <!-- Main Content Area with Sidebar -->
    <div class="flex flex-1 overflow-hidden">
      <!-- Sidebar Navigation -->
      <aside
        id="sidebar"
        class="sidebar bg-white p-6 overflow-y-auto border-r border-gray-200 fixed lg:static inset-y-0 left-0 transform -translate-x-full lg:translate-x-0 transition-transform duration-300 ease-in-out z-20"
      >
        <div class="flex items-center space-x-2 mb-8">
          <span class="text-xl font-bold">HRUSELINK</span>
        </div>
        <nav class="space-y-4">
          <!-- Sidebar links -->
          <a
            href="#"
            class="flex items-center space-x-3 p-3 rounded-lg text-gray-600 hover:bg-indigo-100 hover:text-indigo-700"
          >
            <svg
              class="h-5 w-5"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-10v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 2 0 011 1v4a1 1 0 001 1m-6 0h6"
              ></path>
            </svg>
            <span>Dashboard</span>
          </a>
          <a
            href="#"
            class="flex items-center space-x-3 p-3 rounded-lg bg-indigo-500 text-white font-semibold"
          >
            <svg
              class="h-5 w-5"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2m-2 0h-2m-2 0V3m-2 2h2m0 0h2m-2 0v2m4-2h2m-2 0v2"
              ></path>
            </svg>
            <span>Rekrutmen</span>
          </a>
          <div class="pt-4 border-t border-gray-200">
            <a
              href="#"
              class="flex items-center space-x-3 p-3 rounded-lg text-gray-600 hover:bg-indigo-100 hover:text-indigo-700"
            >
              <svg
                class="h-5 w-5"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m-6 4H4m-2 4h16a2 2 0 002-2v-4a2 2 0 00-2-2H4a2 2 0 00-2 2v4a2 2 0 002 2z"
                ></path>
              </svg>
              <span>Settings</span>
            </a>
          </div>
        </nav>
      </aside>

      <!-- Sidebar backdrop for mobile overlay -->
      <div
        id="sidebar-backdrop"
        class="fixed inset-0 bg-black bg-opacity-50 z-10 hidden lg:hidden"
      ></div>

      <!-- Main Content Area -->
      <main class="content p-6 overflow-y-auto">
        <div class="bg-white p-6 rounded-xl card">
          <h2 class="text-2xl font-bold text-gray-800 mb-4">
            Pengelolaan Data Rekrutmen
          </h2>

          <!-- Alert Success/Error -->
          <div class="alert alert-success" id="alertSuccess" role="alert">
            <span id="alertSuccessMessage"></span>
          </div>
          <div class="alert alert-danger" id="alertError" role="alert">
            <span id="alertErrorMessage"></span>
          </div>

          <!-- Tab Navigation -->
          <div
            class="flex flex-wrap space-x-2 space-y-2 md:space-y-0 mb-6 border-b border-gray-200"
          >
            <button
              id="tab-pelamarMasuk"
              class="tab-button active"
              onclick="showTab('pelamarMasuk')"
            >
              Data Pelamar Masuk
            </button>
            <button
              id="tab-prosesPelamar"
              class="tab-button"
              onclick="showTab('prosesPelamar')"
            >
              Proses Seleksi
            </button>
            <button
              id="tab-kandidatTerpilih"
              class="tab-button"
              onclick="showTab('kandidatTerpilih')"
            >
              Kandidat Terpilih
            </button>
            <button
              id="tab-pelamarTersisih"
              class="tab-button"
              onclick="showTab('pelamarTersisih')"
            >
              Pelamar Tersisih
            </button>
            <button
              id="tab-prosesLanjutan"
              class="tab-button"
              onclick="showTab('prosesLanjutan')"
            >
              Proses Lanjutan (MCU)
            </button>
            <button
              id="tab-prosesInsite"
              class="tab-button"
              onclick="showTab('prosesInsite')"
            >
              Proses Insite (Test Praktek)
            </button>
            <button
              id="tab-pelamarFinal"
              class="tab-button"
              onclick="showTab('pelamarFinal')"
            >
              Pelamar Final
            </button>
          </div>

          <!-- Tab Content Areas -->
          <div id="pelamarMasuk-content" class="tab-content">
            <h3 class="mt-4">Daftar Pelamar Masuk</h3>
            <div class="table-responsive">
              <table
                class="table table-bordered table-hover"
                id="pelamarMasukTable"
              >
                <thead>
                  <tr>
                    <th>ID Pelamar</th>
                    <th>NIK</th>
                    <th>Nama Lengkap</th>
                    <th>Email</th>
                    <th>No Telepon</th>
                    <th>Posisi Dilamar</th>
                    <th>Tanggal Pengajuan</th>
                    <th>Sumber Pengajuan</th>
                    <th>Link CV</th>
                    <th>Aksi</th>
                  </tr>
                </thead>
                <tbody id="pelamarMasukBody">
                  <!-- Data Pelamar Masuk Akan Dimuat di sini -->
                </tbody>
              </table>
            </div>
          </div>

          <div id="prosesPelamar-content" class="tab-content hidden">
            <h3 class="mt-4">Proses Seleksi Pelamar</h3>
            <div class="table-responsive">
              <table
                class="table table-bordered table-hover"
                id="prosesPelamarTable"
              >
                <thead>
                  <tr>
                    <th>ID Pelamar</th>
                    <th>NIK</th>
                    <th>Nama Lengkap</th>
                    <th>Posisi Dilamar</th>
                    <th>Pengalaman Kerja</th>
                    <th>Link CV</th>
                    <th>Jadwal Interview HR</th>
                    <th>Hasil Interview HR</th>
                    <th>Catatan HR</th>
                    <th>Jadwal Interview User1</th>
                    <th>Hasil Interview User1</th>
                    <th>Jadwal Interview User2</th>
                    <th>Hasil Interview User2</th>
                    <th>Hasil Akhir</th>
                    <th>Aksi</th>
                  </tr>
                </thead>
                <tbody id="prosesPelamarBody">
                  <!-- Data Proses Seleksi Akan Dimuat di sini -->
                </tbody>
              </table>
            </div>
          </div>

          <div id="kandidatTerpilih-content" class="tab-content hidden">
            <h3 class="mt-4">Kandidat Terpilih</h3>
            <div class="table-responsive">
              <table
                class="table table-bordered table-hover"
                id="kandidatTerpilihTable"
              >
                <thead>
                  <tr>
                    <th>ID Pelamar</th>
                    <th>NIK</th>
                    <th>Nama Lengkap</th>
                    <th>Posisi Dilamar</th>
                    <th>Status Terpilih</th>
                    <th>Tanggal Terpilih</th>
                    <th>Alasan Terpilih</th>
                  </tr>
                </thead>
                <tbody id="kandidatTerpilihBody">
                  <!-- Data Kandidat Terpilih Akan Dimuat di sini -->
                </tbody>
              </table>
            </div>
          </div>

          <div id="pelamarTersisih-content" class="tab-content hidden">
            <h3 class="mt-4">Pelamar Tersisih</h3>
            <div class="table-responsive">
              <table
                class="table table-bordered table-hover"
                id="pelamarTersisihTable"
              >
                <thead>
                  <tr>
                    <th>ID Pelamar</th>
                    <th>NIK</th>
                    <th>Nama Lengkap</th>
                    <th>Posisi Dilamar</th>
                    <th>Alasan Tersisih</th>
                    <th>Tanggal Tersisih</th>
                    <th>Catatan</th>
                  </tr>
                </thead>
                <tbody id="pelamarTersisihBody">
                  <!-- Data Pelamar Tersisih Akan Dimuat di sini -->
                </tbody>
              </table>
            </div>
          </div>

          <div id="prosesLanjutan-content" class="tab-content hidden">
            <h3 class="mt-4">Proses Lanjutan (MCU)</h3>
            <div class="table-responsive">
              <table
                class="table table-bordered table-hover"
                id="prosesLanjutanTable"
              >
                <thead>
                  <tr>
                    <th>ID Pelamar</th>
                    <th>NIK</th>
                    <th>Nama Lengkap</th>
                    <th>No WA</th>
                    <th>Posisi Dilamar</th>
                    <th>Kota Asal</th>
                    <th>Jadwal MCU</th>
                    <th>Tempat MCU</th>
                    <th>Hasil MCU</th>
                    <th>No Guarantee Letter MCU</th>
                  </tr>
                </thead>
                <tbody id="prosesLanjutanBody">
                  <!-- Data Proses Lanjutan Akan Dimuat di sini -->
                </tbody>
              </table>
            </div>
          </div>

          <div id="prosesInsite-content" class="tab-content hidden">
            <h3 class="mt-4">Proses Insite (Test Praktek)</h3>
            <div class="table-responsive">
              <table
                class="table table-bordered table-hover"
                id="prosesInsiteTable"
              >
                <thead>
                  <tr>
                    <th>ID Pelamar</th>
                    <th>NIK</th>
                    <th>Nama Lengkap</th>
                    <th>Jadwal Insite</th>
                    <th>Jadwal Test Praktek</th>
                    <th>No Dokumen Masuk</th>
                    <th>Hasil Test Praktek</th>
                  </tr>
                </thead>
                <tbody id="prosesInsiteBody">
                  <!-- Data Proses Insite Akan Dimuat di sini -->
                </tbody>
              </table>
            </div>
          </div>

          <div id="pelamarFinal-content" class="tab-content hidden">
            <h3 class="mt-4">Pelamar Final</h3>
            <div class="table-responsive">
              <table
                class="table table-bordered table-hover"
                id="pelamarFinalTable"
              >
                <thead>
                  <tr>
                    <th>ID Pelamar</th>
                    <th>NIK</th>
                    <th>Nama Lengkap</th>
                    <th>Posisi</th>
                    <th>Join Date</th>
                    <th>No Dokumen Kontrak</th>
                  </tr>
                </thead>
                <tbody id="pelamarFinalBody">
                  <!-- Data Pelamar Final Akan Dimuat di sini -->
                </tbody>
              </table>
            </div>
          </div>

          <!-- Tombol Refresh Data (untuk semua tab) -->
          <div class="text-center mt-4">
            <button class="btn btn-primary" id="loadDataButton">
              Refresh Semua Data
            </button>
          </div>
        </div>
      </main>
    </div>

    <!-- Footer Section -->
    <footer
      class="bg-white py-4 px-6 text-center text-sm text-gray-500 border-t border-gray-200 mt-auto"
    >
      DEVELOP BY KAK AFA
    </footer>

    <!-- Bootstrap JS, Popper.js, and jQuery (slim) -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <script>
      // ===========================================================================================================
      // PENTING: PANDUAN UNTUK MENGATASI ERROR 'Failed to fetch' (CORS) DAN MEMASTIKAN KOMUNIKASI DENGAN APPS SCRIPT
      // ===========================================================================================================
      // Jika Anda terus melihat error "Failed to fetch" atau "No 'Access-Control-Allow-Origin' header is present",
      // ini BUKAN masalah pada kode HTML/JavaScript ini. Ini adalah masalah konfigurasi pada Google Apps Script Anda.
      //
      // Ikuti langkah-langkah ini DENGAN SANGAT CERMAT di proyek Google Apps Script Anda:
      //
      // 1.  PASTIKAN KODE APPS SCRIPT ANDA SUDAH BENAR:
      //     Gunakan kode Apps Script yang saya berikan di immersive terpisah di bawah ini.
      //     Pastikan SPREADSHEET_ID di dalamnya sudah diatur ke ID spreadsheet Anda yang benar.
      //
      // 2.  DEPLOY ULANG SEBAGAI WEB APP DENGAN IZIN YANG TEPAT:
      //     a. Buka proyek Google Apps Script Anda.
      //     b. Klik 'Deploy' (ikon roket) di menu atas, lalu pilih 'Manage deployments'.
      //     c. Jika sudah ada deployment, klik ikon pensil untuk mengeditnya. Jika belum ada, klik 'New deployment'.
      //     d. Pilih Tipe: 'Web app'.
      //     e. Eksekusi sebagai (Execute as): 'Me' (alamat email Anda).
      //     f. Siapa yang memiliki akses (Who has access): INI KRUSIAL -> PILIH 'Anyone'.
      //        (Ini yang memungkinkan browser Anda berkomunikasi dari lingkungan lokal seperti 127.0.0.1).
      //     g. Klik 'Deploy' atau 'Save'.
      //     h. Jika diminta otorisasi, ikuti langkah-langkahnya.
      //     i. SALIN URL yang diberikan setelah deployment berhasil.
      //
      // 3.  PERBARUI scriptURL DI KODE HTML INI:
      //     Tempelkan URL yang baru Anda salin dari langkah 2.i ke variabel scriptURL di bawah ini.
      //     Pastikan tidak ada spasi ekstra atau karakter yang salah.
      //
      // Jika semua langkah ini sudah dilakukan dengan benar, error "Failed to fetch" seharusnya akan hilang.
      // ===========================================================================================================
      const scriptURL =
        "https://script.google.com/macros/s/AKfycbwHG_7e6OfZQR620gvIwKg5HWQbo9p8jHzPKGM-52fleUZtrskwoPuEZetx9PMR7_ZF/exec"; // Ganti dengan URL Apps Script Anda

      // --- Konfigurasi Header Spreadsheet ---
      // Pastikan KUNCI (key) di sini SAMA PERSIS dengan nama kolom di baris pertama Google Sheet Anda.
      // Label (label) adalah nama yang akan ditampilkan di tabel HTML.
      const sheetHeaders = {
        Pelamar_Masuk: [
          { key: "ID_Pelamar", label: "ID Pelamar" },
          { key: "NIK", label: "NIK" },
          { key: "Nama_Lengkap", label: "Nama Lengkap" },
          { key: "Email", label: "Email" },
          { key: "No_Telepon", label: "No Telepon" },
          { key: "Posisi_Dilamar", label: "Posisi Dilamar" },
          { key: "Tanggal_Pengajuan", label: "Tanggal Pengajuan" },
          { key: "Sumber_Pengajuan", label: "Sumber Pengajuan" },
          { key: "Link_CV", label: "Link CV" },
          { key: "Status", label: "Status" },
        ],
        Proses_Pelamar: [
          { key: "ID_Pelamar", label: "ID Pelamar" },
          { key: "NIK", label: "NIK" },
          { key: "Nama_Lengkap", label: "Nama Lengkap" },
          { key: "Posisi_Dilamar", label: "Posisi Dilamar" },
          { key: "Pengalaman_Kerja", label: "Pengalaman Kerja" },
          { key: "Link_CV", label: "Link CV" },
          { key: "Jadwal_Interview_HR", label: "Jadwal Interview HR" },
          { key: "Hasil_Interview_HR", label: "Hasil Interview HR" },
          { key: "Catatan_HR", label: "Catatan HR" },
          { key: "Jadwal_Interview_User1", label: "Jadwal Interview User1" },
          { key: "Hasil_Interview_User1", label: "Hasil Interview User1" },
          { key: "Jadwal_Interview_User2", label: "Jadwal Interview User2" },
          { key: "Hasil_Interview_User2", label: "Hasil Interview User2" },
          { key: "Hasil_Akhir", label: "Hasil Akhir" },
        ],
        Kandidat_Terpilih: [
          { key: "ID_Pelamar", label: "ID Pelamar" },
          { key: "NIK", label: "NIK" },
          { key: "Nama_Lengkap", label: "Nama Lengkap" },
          { key: "Posisi_Dilamar", label: "Posisi Dilamar" },
          { key: "Status_Terpilih", label: "Status Terpilih" },
          { key: "Tanggal_Terpilih", label: "Tanggal Terpilih" },
          { key: "Alasan_Terpilih", label: "Alasan Terpilih" },
        ],
        Pelamar_Tersisih: [
          { key: "ID_Pelamar", label: "ID Pelamar" },
          { key: "NIK", label: "NIK" },
          { key: "Nama_Lengkap", label: "Nama Lengkap" },
          { key: "Posisi_Dilamar", label: "Posisi Dilamar" },
          { key: "Alasan_Tersisih", label: "Alasan Tersisih" },
          { key: "Tanggal_Tersisih", label: "Tanggal Tersisih" },
          { key: "Catatan", label: "Catatan" },
        ],
        Proses_Lanjutan: [
          { key: "ID_Pelamar", label: "ID Pelamar" },
          { key: "NIK", label: "NIK" },
          { key: "Nama_Lengkap", label: "Nama Lengkap" },
          { key: "No_WA", label: "No WA" },
          { key: "Posisi_Dilamar", label: "Posisi Dilamar" },
          { key: "Kota_Asal", label: "Kota Asal" },
          { key: "Jadwal_MCU", label: "Jadwal MCU" },
          { key: "Tempat_MCU", label: "Tempat MCU" },
          { key: "Hasil_MCU", label: "Hasil MCU" },
          { key: "No_Guarantee_Letter_MCU", label: "No Guarantee Letter MCU" },
        ],
        Proses_Insite: [
          { key: "ID_Pelamar", label: "ID Pelamar" },
          { key: "NIK", label: "NIK" },
          { key: "Nama_Lengkap", label: "Nama Lengkap" },
          { key: "Jadwal_Insite", label: "Jadwal Insite" },
          { key: "Jadwal_Test_Praktek", label: "Jadwal Test Praktek" },
          { key: "No_Dokumen_Masuk", label: "No Dokumen Masuk" },
          { key: "Hasil_Test_Praktek", label: "Hasil Test Praktek" },
        ],
        Pelamar_Final: [
          { key: "ID_Pelamar", label: "ID Pelamar" },
          { key: "NIK", label: "NIK" },
          { key: "Nama_Lengkap", label: "Nama Lengkap" },
          { key: "Posisi", label: "Posisi" },
          { key: "Join_Date", label: "Join Date" },
          { key: "No_Dokumen_Kontrak", label: "No Dokumen Kontrak" },
        ],
      };

      // --- Fungsi Helper Umum ---
      function showToast(message, type = "success", duration = 3000) {
        const alertDiv =
          type === "success"
            ? document.getElementById("alertSuccess")
            : document.getElementById("alertError");
        const alertMessageSpan =
          type === "success"
            ? document.getElementById("alertSuccessMessage")
            : document.getElementById("alertErrorMessage");

        alertMessageSpan.textContent = message;
        alertDiv.classList.remove("alert-success", "alert-danger");
        alertDiv.classList.add(`alert-${type}`);
        alertDiv.style.display = "block";

        setTimeout(() => {
          alertDiv.style.display = "none";
        }, duration);
      }

      async function sendRequest(
        action,
        params = {},
        method = "GET",
        body = null
      ) {
        let url = new URL(scriptURL);
        url.searchParams.append("action", action);

        for (const key in params) {
          if (params.hasOwnProperty(key)) {
            url.searchParams.append(key, params[key]);
          }
        }

        const options = {
          method: method,
          headers: {
            "Content-Type": "application/json",
          },
        };

        if (body) {
          options.body = JSON.stringify(body);
        }

        try {
          const response = await fetch(url.toString(), options);
          if (!response.ok) {
            const errorText = await response.text();
            throw new Error(
              `HTTP error! Status: ${response.status} - ${
                response.statusText || "Unknown error"
              }. Detail: ${errorText}`
            );
          }
          return await response.json();
        } catch (error) {
          console.error("Error in sendRequest:", error);
          showToast(
            `Kesalahan jaringan: ${error.message}. Pastikan URL Apps Script benar dan di-deploy dengan akses 'Anyone'.`,
            "danger"
          );
          throw error; // Re-throw the error for calling function to handle
        }
      }

      /**
       * Generic function to load data into a table.
       * @param {string} sheetName - The name of the sheet to fetch data from.
       * @param {string} tableBodyId - The ID of the tbody element to populate.
       * @param {Array} headersConfig - The header configuration for this table.
       * @param {string} actionName - The action name to call in Apps Script (e.g., 'getPelamarMasuk').
       */
      async function loadTableData(
        sheetName,
        tableBodyId,
        headersConfig,
        actionName
      ) {
        try {
          const data = await sendRequest(actionName);
          const tableBody = document.getElementById(tableBodyId);
          tableBody.innerHTML = "";

          if (!Array.isArray(data)) {
            console.error(
              `Data received for ${sheetName} is not an array:`,
              data
            );
            showToast(
              `Format data ${sheetName} tidak sesuai. Cek Apps Script logs.`,
              "danger"
            );
            return;
          }

          data.forEach((item) => {
            let row = document.createElement("tr");
            let rowHtml = "";
            headersConfig.forEach((header) => {
              let cellValue = item[header.key];
              if (
                cellValue === undefined ||
                cellValue === null ||
                cellValue === ""
              ) {
                cellValue = "-";
              } else if (
                header.key.includes("Tanggal") ||
                header.key.includes("Date") ||
                header.key.includes("Jadwal")
              ) {
                try {
                  if (cellValue && !isNaN(new Date(cellValue).getTime())) {
                    cellValue = new Date(cellValue).toLocaleDateString("id-ID");
                  }
                } catch (e) {
                  // Keep original value if date parsing fails
                }
              } else if (header.key === "Link_CV" && cellValue !== "-") {
                cellValue = `<a href="${cellValue}" target="_blank">Lihat CV</a>`;
              }
              rowHtml += `<td>${cellValue}</td>`;
            });

            // Add action buttons based on the sheet
            if (sheetName === "Pelamar_Masuk") {
              rowHtml += `
                            <td>
                                <button class="btn btn-info btn-sm btn-action" onclick="editPelamar('${item.ID_Pelamar}')">Edit</button>
                                <button class="btn btn-danger btn-sm btn-action" onclick="hapusPelamar('${item.ID_Pelamar}')">Hapus</button>
                                <button class="btn btn-success btn-sm btn-action" onclick="moveToKandidatTerpilih('${item.ID_Pelamar}')">Lolos Seleksi</button>
                                <button class="btn btn-warning btn-sm btn-action" onclick="moveToPelamarTersisih('${item.ID_Pelamar}')">Tersisih</button>
                            </td>
                        `;
            } else if (sheetName === "Proses_Pelamar") {
              rowHtml += `
                            <td>
                                <button class="btn btn-info btn-sm btn-action" onclick="editProsesSeleksi('${item.ID_Pelamar}')">Edit</button>
                                <button class="btn btn-success btn-sm btn-action" onclick="sendWhatsAppReport('${item.ID_Pelamar}')">WhatsApp</button>
                            </td>
                        `;
            } else {
              rowHtml += `<td>-</td>`; // No actions for other tables by default
            }

            row.innerHTML = rowHtml;
            tableBody.appendChild(row);
          });
          showToast(
            `Data ${sheetName.replace(/_/g, " ")} berhasil dimuat.`,
            "success"
          );
        } catch (error) {
          console.error(`Error loading ${sheetName} data:`, error);
          showToast(
            `Gagal memuat data ${sheetName.replace(/_/g, " ")}. Detail: ${
              error.message
            }`,
            "danger"
          );
        }
      }

      // --- Tab Management ---
      let currentActiveTab = "pelamarMasuk"; // Default active tab

      function showTab(tabName) {
        // Update button styles
        document
          .querySelectorAll(".tab-button")
          .forEach((btn) => btn.classList.remove("active"));
        document.getElementById(`tab-${tabName}`).classList.add("active");

        // Hide all content divs
        document
          .querySelectorAll(".tab-content")
          .forEach((contentDiv) => contentDiv.classList.add("hidden"));

        // Show selected tab content
        document
          .getElementById(`${tabName}-content`)
          .classList.remove("hidden");
        currentActiveTab = tabName;

        // Load data for the active tab
        switch (tabName) {
          case "pelamarMasuk":
            loadTableData(
              "Pelamar_Masuk",
              "pelamarMasukBody",
              sheetHeaders.Pelamar_Masuk,
              "getPelamarMasuk"
            );
            break;
          case "prosesPelamar":
            loadTableData(
              "Proses_Pelamar",
              "prosesPelamarBody",
              sheetHeaders.Proses_Pelamar,
              "getProsesSeleksi"
            );
            break;
          case "kandidatTerpilih":
            loadTableData(
              "Kandidat_Terpilih",
              "kandidatTerpilihBody",
              sheetHeaders.Kandidat_Terpilih,
              "getKandidatTerpilih"
            );
            break;
          case "pelamarTersisih":
            loadTableData(
              "Pelamar_Tersisih",
              "pelamarTersisihBody",
              sheetHeaders.Pelamar_Tersisih,
              "getPelamarTersisih"
            );
            break;
          case "prosesLanjutan":
            loadTableData(
              "Proses_Lanjutan",
              "prosesLanjutanBody",
              sheetHeaders.Proses_Lanjutan,
              "getProsesLanjutan"
            );
            break;
          case "prosesInsite":
            loadTableData(
              "Proses_Insite",
              "prosesInsiteBody",
              sheetHeaders.Proses_Insite,
              "getProsesInsite"
            );
            break;
          case "pelamarFinal":
            loadTableData(
              "Pelamar_Final",
              "pelamarFinalBody",
              sheetHeaders.Pelamar_Final,
              "getPelamarFinal"
            );
            break;
          default:
            console.error("Tab tidak dikenal:", tabName);
        }
      }

      // --- Fungsi Aksi ---
      function editPelamar(id) {
        showToast(
          "Fungsi edit untuk ID Pelamar: " + id + " (belum diimplementasikan)",
          "info"
        );
        // Implementasikan edit sesuai kebutuhan (misal dengan modal form atau redirect ke halaman edit)
        // Anda perlu mengambil data pelamar berdasarkan ID dan mengisi form edit.
        // Setelah edit, panggil sendRequest dengan action 'editPelamar' dan data yang diupdate.
      }

      async function hapusPelamar(id) {
        if (
          !confirm(`Apakah Anda yakin ingin menghapus pelamar dengan ID ${id}?`)
        ) {
          return;
        }
        try {
          let result = await sendRequest("deletePelamar", {}, "POST", {
            id: id,
          });
          if (result.status === "success") {
            showToast("Pelamar berhasil dihapus.", "success");
            showTab(currentActiveTab); // Reload current tab
          } else {
            showToast(`Gagal menghapus pelamar. ${result.message}`, "danger");
          }
        } catch (error) {
          console.error("Error hapus pelamar:", error);
          showToast(
            `Gagal menghapus pelamar. Detail: ${error.message}`,
            "danger"
          );
        }
      }

      async function moveToKandidatTerpilih(id) {
        if (
          !confirm(
            `Pindahkan pelamar dengan ID ${id} ke Kandidat Terpilih? Ini akan menghapus dari Pelamar Masuk.`
          )
        ) {
          return;
        }
        try {
          let result = await sendRequest("moveToKandidatTerpilih", {}, "POST", {
            id: id,
          });
          if (result.status === "success") {
            showToast(result.message, "success");
            showTab(currentActiveTab); // Reload current tab (Pelamar Masuk)
          } else {
            showToast(`Gagal memindahkan pelamar. ${result.message}`, "danger");
          }
        } catch (error) {
          console.error("Error memindahkan pelamar:", error);
          showToast(
            `Gagal memindahkan pelamar. Detail: ${error.message}`,
            "danger"
          );
        }
      }

      async function moveToPelamarTersisih(id) {
        if (
          !confirm(
            `Pindahkan pelamar dengan ID ${id} ke Pelamar Tersisih? Ini akan menghapus dari Pelamar Masuk.`
          )
        ) {
          return;
        }
        try {
          let result = await sendRequest("moveToPelamarTersisih", {}, "POST", {
            id: id,
          });
          if (result.status === "success") {
            showToast(result.message, "success");
            showTab(currentActiveTab); // Reload current tab (Pelamar Masuk)
          } else {
            showToast(`Gagal memindahkan pelamar. ${result.message}`, "danger");
          }
        } catch (error) {
          console.error("Error memindahkan pelamar:", error);
          showToast(
            `Gagal memindahkan pelamar. Detail: ${error.message}`,
            "danger"
          );
        }
      }

      function editProsesSeleksi(id) {
        showToast(
          "Fungsi edit proses seleksi untuk ID Pelamar: " +
            id +
            " (belum diimplementasikan)",
          "info"
        );
        // Implementasikan edit sesuai kebutuhan
      }

      async function sendWhatsAppReport(idPelamar) {
        const phoneNumber = "6282147422821"; // Nomor WhatsApp tujuan (format internasional tanpa '+')

        showToast("Membuat laporan WhatsApp...", "info");

        try {
          // Ambil data spesifik kandidat dari Proses_Pelamar
          const allProsesData = await sendRequest("getProsesSeleksi");
          const candidate = allProsesData.find(
            (p) => String(p.ID_Pelamar) === String(idPelamar)
          );

          if (!candidate) {
            showToast(
              "Data kandidat tidak ditemukan untuk laporan WhatsApp.",
              "danger"
            );
            return;
          }

          const today = new Date().toLocaleDateString("id-ID", {
            weekday: "long",
            year: "numeric",
            month: "long",
            day: "numeric",
          });

          let reportMessage = `üåü *Laporan Proses Kandidat - ${today}* ÔøΩ\n\n`;
          reportMessage += `*Detail Kandidat:*\n`;
          reportMessage += `üßë‚Äçüíº *Nama:* ${candidate.Nama_Lengkap || "-"}\n`;
          reportMessage += `üÜî *ID Pelamar:* ${candidate.ID_Pelamar || "-"}\n`;
          reportMessage += `üî¢ *NIK:* ${candidate.NIK || "-"}\n`;
          reportMessage += `üíº *Posisi Dilamar:* ${
            candidate.Posisi_Dilamar || "-"
          }\n`;
          reportMessage += `\n*Tahap Proses:*\n`;
          reportMessage += `  - *Jadwal Interview HR:* ${
            candidate.Jadwal_Interview_HR
              ? new Date(candidate.Jadwal_Interview_HR).toLocaleDateString(
                  "id-ID"
                )
              : "-"
          }\n`;
          reportMessage += `  - *Hasil Interview HR:* ${
            candidate.Hasil_Interview_HR || "-"
          }\n`;
          reportMessage += `  - *Catatan HR:* ${candidate.Catatan_HR || "-"}\n`;
          reportMessage += `  - *Jadwal Interview User1:* ${
            candidate.Jadwal_Interview_User1
              ? new Date(candidate.Jadwal_Interview_User1).toLocaleDateString(
                  "id-ID"
                )
              : "-"
          }\n`;
          reportMessage += `  - *Hasil Interview User1:* ${
            candidate.Hasil_Interview_User1 || "-"
          }\n`;
          reportMessage += `  - *Jadwal Interview User2:* ${
            candidate.Jadwal_Interview_User2
              ? new Date(candidate.Jadwal_Interview_User2).toLocaleDateString(
                  "id-ID"
                )
              : "-"
          }\n`;
          reportMessage += `  - *Hasil Interview User2:* ${
            candidate.Hasil_Interview_User2 || "-"
          }\n`;
          reportMessage += `  - *Hasil Akhir:* ${
            candidate.Hasil_Akhir || "-"
          }\n`;
          reportMessage += `\n_Laporan ini dibuat secara otomatis dari Sistem HRIS AQHSA SHOFIA. Mohon ditindaklanjuti._\n`;
          reportMessage += `Terima kasih! üôè`;

          const whatsappUrl = `https://wa.me/${phoneNumber}?text=${encodeURIComponent(
            reportMessage
          )}`;
          window.open(whatsappUrl, "_blank"); // Open WhatsApp in a new tab

          showToast(
            "Laporan WhatsApp berhasil dibuat dan dibuka di tab baru.",
            "success"
          );
        } catch (error) {
          console.error("Error generating WhatsApp report:", error);
          showToast(
            `Gagal membuat laporan WhatsApp. Detail: ${error.message}`,
            "danger"
          );
        }
      }

      // --- Event Listener Utama ---
      document
        .getElementById("loadDataButton")
        .addEventListener("click", function () {
          showTab(currentActiveTab); // Reload the currently active tab
        });

      // Memuat data awal saat halaman dibuka
      window.onload = function () {
        showTab("pelamarMasuk"); // Tampilkan tab Pelamar Masuk secara default
      };
    </script>
  </body>
</html>
ÔøΩ
