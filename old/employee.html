<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AQHSA SHOFIA - HRIS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Inter", sans-serif;
        background-color: #f4f5f8;
      }
      .sidebar {
        width: 256px;
        min-width: 256px;
      }
      .content {
        flex-grow: 1;
      }
      .card {
        box-shadow: 0 4px 6px -1-px rgba(0, 0, 0, 0.1),
          0 2px 4px -1px rgba(0, 0, 0, 0.06);
        border-radius: 12px;
      }
      /* Style untuk modal */
      .modal {
        background-color: rgba(0, 0, 0, 0.5);
        transition: opacity 0.3s ease;
      }
      .modal-content {
        transform: translateY(-20px);
        opacity: 0;
        transition: transform 0.3s ease, opacity 0.3s ease;
      }
      .modal.is-active .modal-content {
        transform: translateY(0);
        opacity: 1;
      }
      .form-section {
        border-bottom: 1px solid #e5e7eb;
        padding-bottom: 1.5rem;
        margin-bottom: 1.5rem;
      }
      .form-section:last-child {
        border-bottom: none;
        padding-bottom: 0;
        margin-bottom: 0;
      }
      .changes-log {
        max-height: 150px;
        overflow-y: auto;
      }
    </style>
  </head>
  <body class="flex flex-col min-h-screen">
    <!-- Header -->
    <header
      class="bg-white shadow-sm py-4 px-6 flex items-center justify-between lg:justify-start lg:space-x-4 z-10 sticky top-0"
    >
      <!-- Tombol hamburger untuk tampilan mobile -->
      <button
        id="sidebar-toggle-btn"
        class="lg:hidden p-2 rounded-md text-gray-500 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-indigo-500"
      >
        <svg
          class="h-6 w-6"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M4 6h16M4 12h16M4 18h16"
          ></path>
        </svg>
      </button>
      <h1 class="text-2xl font-bold text-gray-800">AQHSA SHOFIA - HRIS</h1>
      <div class="flex items-center space-x-4 ml-auto">
        <svg
          class="h-6 w-6 text-gray-500"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"
          ></path>
        </svg>
        <div class="relative">
          <img
            src="https://placehold.co/40x40/94a3b8/ffffff?text=U"
            alt="User"
            class="w-10 h-10 rounded-full cursor-pointer"
          />
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <div class="flex flex-1 overflow-hidden">
      <!-- Sidebar -->
      <aside
        id="sidebar"
        class="sidebar bg-white p-6 overflow-y-auto border-r border-gray-200 fixed lg:static inset-y-0 left-0 transform -translate-x-full lg:translate-x-0 transition-transform duration-300 ease-in-out z-20"
      >
        <div class="flex items-center space-x-2 mb-8">
          <span class="text-xl font-bold">ONLY FOR CACA</span>
        </div>
        <nav class="space-y-4">
          <a
            href="index.html"
            class="flex items-center space-x-3 p-3 rounded-lg bg-indigo-500 text-white font-semibold"
          >
            <svg
              class="h-5 w-5"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-10v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"
              ></path>
            </svg>
            <span>Dashboard</span>
          </a>
          <a
            href="employee.html"
            class="flex items-center space-x-3 p-3 rounded-lg text-gray-600 hover:bg-indigo-100 hover:text-indigo-700"
          >
            <svg
              class="h-5 w-5"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 4.354a4 4 0 110 5.292M15 21H9a6 6 0 01-6-6v-1a6 6 0 016-6h6a6 6 0 016 6v1a6 6 0 01-6 6z"
              ></path>
            </svg>
            <span>Employee</span>
          </a>
          <a
            href="reporting.html"
            class="flex items-center space-x-3 p-3 rounded-lg text-gray-600 hover:bg-indigo-100 hover:text-indigo-700"
          >
            <svg
              class="h-5 w-5"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 4h4a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm0 0H7a2 2 0 01-2-2v-6a2 2 0 012-2h2a2 2 0 012 2v6a2 2 0 01-2 2z"
              ></path>
            </svg>
            <span>Reporting</span>
          </a>
          <a
            href="leave.html"
            class="flex items-center space-x-3 p-3 rounded-lg text-gray-600 hover:bg-indigo-100 hover:text-indigo-700"
          >
            <svg
              class="h-5 w-5"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M8 7V3m8 4V3m-4 8v.01M12 12v.01M12 16v.01M3 20h18M3 10h18a2 2 0 012 2v4a2 2 0 01-2 2H3a2 2 0 01-2-2v-4a2 2 0 012-2z"
              ></path>
            </svg>
            <span>Leave</span>
          </a>
          <a
            href="recruitment.html"
            class="flex items-center space-x-3 p-3 rounded-lg text-gray-600 hover:bg-indigo-100 hover:text-indigo-700"
          >
            <svg
              class="h-5 w-5"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2m-2 0h-2m-2 0V3m-2 2h2m0 0h2m-2 0v2m4-2h2m-2 0v2"
              ></path>
            </svg>
            <span>Recruitment Process</span>
          </a>
          <a
            href="generate_letter.html"
            class="flex items-center space-x-3 p-3 rounded-lg text-gray-600 hover:bg-indigo-100 hover:text-indigo-700"
          >
            <svg
              class="h-5 w-5"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M9 12h6m-6 4h6m-6 4h6m-6-4h.01M12 4v4m0 0h.01M12 8h-2m2 0h2m-2 0v-2m-2 2v2a2 2 0 002 2h2a2 2 0 002-2v-2m-2 0H9a2 2 0 00-2 2v4a2 2 0 002 2h6a2 2 0 002-2v-4a2 2 0 00-2-2z"
              ></path>
            </svg>
            <span>Generate Letter</span>
          </a>
          <a
            href="surat_peringatan.html"
            class="flex items-center space-x-3 p-3 rounded-lg text-gray-600 hover:bg-indigo-100 hover:text-indigo-700"
          >
            <svg
              class="h-5 w-5"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 9v2m0 4h.01m-6 5h12a2 2 0 002-2V7a2 2 0 00-2-2H6a2 2 0 00-2 2v10a2 2 0 002 2z"
              ></path>
            </svg>
            <span>Surat Peringatan</span>
          </a>
          <div class="pt-4 border-t border-gray-200">
            <a
              href="settings.html"
              class="flex items-center space-x-3 p-3 rounded-lg text-gray-600 hover:bg-indigo-100 hover:text-indigo-700"
            >
              <svg
                class="h-5 w-5"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m-6 4H4m-2 4h16a2 2 0 002-2v-4a2 2 0 00-2-2H4a2 2 0 00-2 2v4a2 2 0 002 2z"
                ></path>
              </svg>
              <span>Settings</span>
            </a>
          </div>
        </nav>
      </aside>

      <div
        id="sidebar-backdrop"
        class="fixed inset-0 bg-black bg-opacity-50 z-10 hidden lg:hidden"
      ></div>

      <!-- Main Content Area -->
      <main class="content p-6 overflow-y-auto">
        <div class="flex items-center justify-between mb-2">
          <h2 id="page-title" class="text-2xl font-bold text-gray-800">
            Employee List
          </h2>
          <div class="flex space-x-2">
            <button
              id="achievement-btn"
              class="bg-white text-gray-800 border border-gray-300 py-2 px-4 rounded-lg font-medium hover:bg-gray-100 transition-colors duration-200"
            >
              Ach. Data 100%
            </button>
            <button
              id="import-btn"
              class="bg-white text-gray-800 border border-gray-300 py-2 px-4 rounded-lg font-medium hover:bg-gray-100 transition-colors duration-200"
            >
              Import CSV
            </button>
            <button
              id="export-btn"
              class="bg-white text-gray-800 border border-gray-300 py-2 px-4 rounded-lg font-medium hover:bg-gray-100 transition-colors duration-200"
            >
              Export CSV
            </button>
            <button
              id="add-item-btn"
              class="bg-indigo-500 text-white py-2 px-4 rounded-lg font-medium hover:bg-indigo-600 flex items-center transition-colors duration-200"
            >
              <svg
                class="h-5 w-5 mr-2"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M12 6v6m0 0v6m0-6h6m-6 0H6"
                ></path>
              </svg>
              Add Employee
            </button>
          </div>
        </div>
        <p id="last-updated-text" class="text-xs text-gray-500 mb-4"></p>

        <!-- Tabs Section untuk beralih antara Employee dan Family -->
        <div class="flex items-center space-x-4 border-b border-gray-200 mb-6">
          <button
            id="tab-employee"
            class="py-2 px-4 border-b-2 border-indigo-500 text-indigo-600 font-semibold transition-colors duration-200"
          >
            Employee
          </button>
          <button
            id="tab-family"
            class="py-2 px-4 border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 transition-colors duration-200"
          >
            Family
          </button>
        </div>

        <!-- Content Container -->
        <div
          id="table-container"
          class="bg-white rounded-xl card overflow-hidden"
        >
          <div
            class="p-4 flex flex-col md:flex-row items-center justify-between border-b border-gray-200 space-y-2 md:space-y-0"
          >
            <div
              class="flex flex-col lg:flex-row items-center space-y-2 lg:space-y-0 lg:space-x-2 w-full md:w-auto"
            >
              <input
                id="search-input"
                type="text"
                placeholder="Search..."
                class="border border-gray-300 rounded-lg px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 w-full lg:w-48"
              />

              <!-- Dropdown Filter Departemen -->
              <select
                id="filter-department"
                class="border border-gray-300 rounded-lg px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 w-full lg:w-48"
              >
                <option value="">All Department</option>
              </select>

              <!-- Dropdown Filter Section -->
              <select
                id="filter-section"
                class="border border-gray-300 rounded-lg px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 w-full lg:w-48"
              >
                <option value="">All Section</option>
              </select>

              <!-- Dropdown Filter Grade -->
              <select
                id="filter-grade"
                class="border border-gray-300 rounded-lg px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 w-full lg:w-48"
              >
                <option value="">All Grade</option>
              </select>

              <!-- Dropdown Filter POH Status -->
              <select
                id="filter-poh-status"
                class="border border-gray-300 rounded-lg px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 w-full lg:w-48"
              >
                <option value="">All POH Status</option>
              </select>
            </div>
            <div class="flex items-center space-x-2">
              <button
                id="bulk-delete-btn"
                class="bg-red-500 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-red-600 hidden transition-colors duration-200"
              >
                Bulk Delete
              </button>
            </div>
          </div>
          <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
              <thead id="table-header" class="bg-gray-50">
                <!-- Header tabel akan diisi oleh JavaScript -->
              </thead>
              <tbody id="table-body" class="bg-white divide-y divide-gray-200">
                <!-- Baris tabel akan diisi oleh JavaScript -->
              </tbody>
            </table>
          </div>
          <!-- Pagination -->
          <div
            id="pagination"
            class="p-4 flex items-center justify-between border-t border-gray-200"
          >
            <!-- Pagination akan diisi oleh JavaScript -->
          </div>
        </div>
      </main>
    </div>

    <!-- Modal untuk Detail/Edit Karyawan dan Keluarga -->
    <div
      id="data-modal"
      class="modal fixed inset-0 flex items-center justify-center p-4 hidden"
    >
      <div
        class="modal-content bg-white rounded-xl card p-6 w-full max-w-4xl max-h-[90vh] overflow-y-auto"
      >
        <div class="flex items-center justify-between border-b pb-4 mb-4">
          <h3 id="modal-title" class="text-xl font-bold text-gray-800">
            Employee Details
          </h3>
          <button
            id="close-modal-btn"
            class="text-gray-500 hover:text-gray-800"
          >
            <svg
              class="h-6 w-6"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M6 18L18 6M6 6l12 12"
              ></path>
            </svg>
          </button>
        </div>
        <!-- Form untuk detail/edit data -->
        <form id="data-form">
          <!-- Form fields akan diisi oleh JavaScript -->
        </form>
        <div
          id="changes-log"
          class="mt-4 p-4 bg-gray-100 rounded-lg text-sm text-gray-700 changes-log hidden"
        >
          <p class="font-semibold mb-2">Catatan Perubahan:</p>
          <ul id="changes-list" class="list-disc list-inside">
            <!-- Log perubahan akan diisi di sini -->
          </ul>
        </div>
        <div class="mt-6 flex justify-end space-x-2">
          <button
            id="cancel-form-btn"
            class="bg-gray-300 text-gray-800 px-4 py-2 rounded-lg font-medium hover:bg-gray-400 transition-colors duration-200"
          >
            Batal
          </button>
          <button
            id="save-form-btn"
            class="bg-indigo-500 text-white px-4 py-2 rounded-lg font-medium hover:bg-indigo-600 transition-colors duration-200"
          >
            Simpan
          </button>
        </div>
      </div>
    </div>

    <!-- Modal untuk Achievement All Data -->
    <div
      id="achievement-modal"
      class="modal fixed inset-0 flex items-center justify-center p-4 hidden"
    >
      <div
        class="modal-content bg-white rounded-xl card p-6 w-full max-w-lg max-h-[90vh] overflow-y-auto"
      >
        <div class="flex items-center justify-between border-b pb-4 mb-4">
          <h3 class="text-xl font-bold text-gray-800">Achievement All Data</h3>
          <button
            id="close-achievement-modal-btn"
            class="text-gray-500 hover:text-gray-800"
          >
            <svg
              class="h-6 w-6"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M6 18L18 6M6 6l12 12"
              ></path>
            </svg>
          </button>
        </div>
        <div id="achievement-list">
          <!-- Ringkasan achievement akan diisi di sini -->
        </div>
        <div class="mt-6 text-center">
          <p class="text-gray-500">
            Persentase dihitung berdasarkan data yang terisi dari semua field
            yang ada.
          </p>
        </div>
      </div>
    </div>

    <!-- Toast Notification -->
    <div
      id="toast-notification"
      class="fixed bottom-4 right-4 bg-gray-800 text-white px-4 py-2 rounded-lg shadow-xl hidden transition-opacity duration-300"
    >
      <!-- Notifikasi akan diisi oleh JavaScript -->
    </div>

    <!-- Footer -->
    <footer
      class="bg-white py-4 px-6 text-center text-sm text-gray-500 border-t border-gray-200 mt-auto"
    >
      DEVELOP BY KAK AFA
    </footer>

    <script>
      (function () {
        // Masukkan URL Web App Google Apps Script Anda di sini
        const SCRIPT_URL =
          "https://script.google.com/macros/s/AKfycbzLVfD4fltbo5WtX1PU6-KH1q5xAM9h8JVAkz19GJRguIEt5_tTu_ftgDghgjaUfLIj/exec";

        // Data akan diambil dari Google Spreadsheet
        let employees = [];
        let families = [];
        let originalItem = {};

        let currentView = "employee";
        let currentPage = 1;
        const itemsPerPage = 10;
        let isLoading = false;

        // Mendapatkan referensi elemen DOM
        const sidebar = document.getElementById("sidebar");
        const sidebarToggleBtn = document.getElementById("sidebar-toggle-btn");
        const sidebarBackdrop = document.getElementById("sidebar-backdrop");
        const tableHeader = document.getElementById("table-header");
        const tableBody = document.getElementById("table-body");
        const pageTitle = document.getElementById("page-title");
        const addItemBtn = document.getElementById("add-item-btn");
        const tabEmployee = document.getElementById("tab-employee");
        const tabFamily = document.getElementById("tab-family");
        const dataModal = document.getElementById("data-modal");
        const closeModalBtn = document.getElementById("close-modal-btn");
        const cancelFormBtn = document.getElementById("cancel-form-btn");
        const saveFormBtn = document.getElementById("save-form-btn");
        const dataForm = document.getElementById("data-form");
        const searchInput = document.getElementById("search-input");
        const exportBtn = document.getElementById("export-btn");
        const importBtn = document.getElementById("import-btn");
        const achievementBtn = document.getElementById("achievement-btn");
        const achievementModal = document.getElementById("achievement-modal");
        const achievementList = document.getElementById("achievement-list");
        const closeAchievementModalBtn = document.getElementById(
          "close-achievement-modal-btn"
        );
        const modalTitle = document.getElementById("modal-title");
        const mainContent = document.querySelector("main");
        const changesLog = document.getElementById("changes-log");
        const changesList = document.getElementById("changes-list");
        const lastUpdatedText = document.getElementById("last-updated-text");
        const toastNotification = document.getElementById("toast-notification");

        // Elemen filter
        const filterDepartment = document.getElementById("filter-department");
        const filterSection = document.getElementById("filter-section");
        const filterGrade = document.getElementById("filter-grade");
        const filterPohStatus = document.getElementById("filter-poh-status");

        // Headers untuk setiap tabel
        const employeeHeaders = [
          { key: "NAME", label: "NAME" },
          { key: "NRP", label: "NRP" },
          { key: "POSITION", label: "POSITION" },
          { key: "DEPARTMENT", label: "DEPT" },
          { key: "HIRING DATE", label: "HIRING DATE" },
          { key: "ACHIEVEMENT", label: "ACHIEVEMENT" },
          { key: "STATUS", label: "STATUS" },
        ];

        const familyHeaders = [
          { key: "FAMILY NAME", label: "NAME" },
          { key: "NRP", label: "NRP" },
          { key: "FAMILY RELATION CODE", label: "RELATION" },
          { key: "BIRTH DATE", label: "BIRTH DATE" },
          { key: "BPJS HEALTH", label: "BPJS HEALTH" },
          { key: "INSURANCE PROVIDER", label: "INSURANCE PROVIDER" },
        ];

        // Semua field untuk form detail, dikelompokkan
        const employeeFormFields = {
          "Personal Details": [
            { key: "NRP", label: "NRP", type: "text" },
            { key: "NAME", label: "NAME", type: "text" },
            {
              key: "GENDER",
              label: "GENDER",
              type: "select",
              options: ["Male", "Female"],
            },
            { key: "PLACE OF BIRTH", label: "PLACE OF BIRTH", type: "text" },
            { key: "DATE OF BIRTH", label: "DATE OF BIRTH", type: "date" },
            {
              key: "RELIGION",
              label: "RELIGION",
              type: "select",
              options: [
                "Islam",
                "Kristen",
                "Katolik",
                "Konghucu",
                "Buddha",
                "Hindu",
              ],
            },
            {
              key: "MARITAL STATUS",
              label: "MARITAL STATUS",
              type: "select",
              options: ["TK", "K0", "K1", "K2", "K3"],
            },
            {
              key: "BLOOD TYPE",
              label: "BLOOD TYPE",
              type: "select",
              options: ["A", "AB", "O", "B"],
            },
            {
              key: "EDUCATION",
              label: "EDUCATION",
              type: "select",
              options: ["SD", "SMP", "SMK/SMA", "D3", "D4", "S1", "S2"],
            },
          ],
          "Contact & Address": [
            { key: "EMAIL", label: "EMAIL", type: "email" },
            { key: "PHONE NUMBER", label: "PHONE NUMBER", type: "tel" },
            { key: "EMERGENCY NUMBER", label: "EMERGENCY NUMBER", type: "tel" },
            { key: "ADDRESS", label: "ADDRESS", type: "text" },
            { key: "VILLAGE", label: "VILLAGE", type: "text" },
            { key: "SUB-DISTRICT", label: "SUB-DISTRICT", type: "text" },
            { key: "CITY", label: "CITY", type: "text" },
            { key: "PROVINCE", label: "PROVINCE", type: "text" },
          ],
          "Employment Details": [
            { key: "COMPANY", label: "COMPANY", type: "text" },
            { key: "DEPARTMENT", label: "DEPARTMENT", type: "text" },
            { key: "SECTION", label: "SECTION", type: "text" },
            { key: "POSITION", label: "POSITION", type: "text" },
            { key: "GRADE", label: "GRADE", type: "text" },
            { key: "SUPERVISOR NRP", label: "SUPERVISOR NRP", type: "text" },
            {
              key: "STATUS POH",
              label: "STATUS POH",
              type: "select",
              options: ["Lokal", "Non-Lokal"],
            },
            { key: "HIRING DATE", label: "HIRING DATE", type: "date" },
            { key: "LEAVE PERIOD", label: "LEAVE PERIOD", type: "text" },
            { key: "STATUS", label: "STATUS", type: "text" },
          ],
          "Administration & Insurance": [
            { key: "KTP NUMBER", label: "KTP NUMBER", type: "text" },
            {
              key: "KTP FAMILY NUMBER",
              label: "KTP FAMILY NUMBER",
              type: "text",
            },
            { key: "NPWP", label: "NPWP", type: "text" },
            { key: "ACCOUNT NUMBER", label: "ACCOUNT NUMBER", type: "text" },
            { key: "BANK NAME", label: "BANK NAME", type: "text" },
            {
              key: "ACCOUNT HOLDER NAME",
              label: "ACCOUNT HOLDER NAME",
              type: "text",
            },
            { key: "BPJS EMPLOYMENT", label: "BPJS EMPLOYMENT", type: "text" },
            { key: "BPJS HEALTH", label: "BPJS HEALTH", type: "text" },
            {
              key: "PRIVATE INSURANCE",
              label: "PRIVATE INSURANCE",
              type: "text",
            },
            {
              key: "INSURANCE PROVIDER",
              label: "INSURANCE PROVIDER",
              type: "text",
            },
            {
              key: "INSURANCE PREMIUM",
              label: "INSURANCE PREMIUM",
              type: "text",
            },
            { key: "DAR", label: "DAR", type: "text" },
            { key: "UDL", label: "UDL", type: "text" },
            { key: "MCU EXPIRATION", label: "MCU EXPIRATION", type: "date" },
          ],
          Other: [
            { key: "MESS", label: "MESS", type: "text" },
            { key: "POH", label: "POH", type: "text" },
            { key: "SHIRT SIZE", label: "SHIRT SIZE", type: "text" },
            { key: "PANTS SIZE", label: "PANTS SIZE", type: "text" },
            { key: "SHOE SIZE", label: "SHOE SIZE", type: "text" },
          ],
        };

        const familyFormFields = {
          "Family Details": [
            { key: "NRP", label: "EMPLOYEE NRP", type: "text" },
            { key: "FAMILY NAME", label: "FAMILY MEMBER NAME", type: "text" },
            {
              key: "FAMILY RELATION CODE",
              label: "RELATIONSHIP",
              type: "text",
            },
            {
              key: "GENDER",
              label: "GENDER",
              type: "select",
              options: ["Male", "Female"],
            },
            { key: "BIRTH DATE", label: "BIRTH DATE", type: "date" },
            { key: "ID NUMBER", label: "ID NUMBER", type: "text" },
          ],
          Insurance: [
            { key: "BPJS HEALTH", label: "BPJS HEALTH", type: "text" },
            {
              key: "PRIVATE INSURANCE",
              label: "PRIVATE INSURANCE",
              type: "text",
            },
            {
              key: "INSURANCE PROVIDER",
              label: "INSURANCE PROVIDER",
              type: "text",
            },
          ],
        };

        // Fungsi untuk menampilkan/menyembunyikan sidebar di mobile
        function showSidebar() {
          sidebar.classList.remove("-translate-x-full");
          sidebar.classList.add("translate-x-0");
          sidebarBackdrop.classList.remove("hidden");
        }

        function hideSidebar() {
          sidebar.classList.remove("translate-x-0");
          sidebar.classList.add("-translate-x-full");
          sidebarBackdrop.classList.add("hidden");
        }

        sidebarToggleBtn.addEventListener("click", showSidebar);
        sidebarBackdrop.addEventListener("click", hideSidebar);

        function showToast(message, duration = 3000) {
          toastNotification.textContent = message;
          toastNotification.classList.remove("hidden", "opacity-0");
          toastNotification.classList.add("opacity-100");
          setTimeout(() => {
            toastNotification.classList.remove("opacity-100");
            toastNotification.classList.add("opacity-0");
            setTimeout(() => {
              toastNotification.classList.add("hidden");
            }, 300);
          }, duration);
        }

        // Fungsi untuk menampilkan loading indicator
        function showLoading() {
          isLoading = true;
          mainContent.classList.add("opacity-50", "pointer-events-none");
          lastUpdatedText.textContent = "Memuat data...";
        }

        // Fungsi untuk menyembunyikan loading indicator
        function hideLoading() {
          isLoading = false;
          mainContent.classList.remove("opacity-50", "pointer-events-none");
        }

        // Fetch data dari Google Spreadsheet
        async function fetchData(sheetName) {
          showLoading();
          try {
            const response = await fetch(`${SCRIPT_URL}?sheet=${sheetName}`);
            const data = await response.json();

            if (response.ok) {
              if (sheetName === "DATA_KARYAWAN") {
                employees = data;
              } else {
                families = data;
              }
              lastUpdatedText.textContent = `Terakhir diperbarui: ${new Date().toLocaleString()}`;
              showToast("Data berhasil diperbarui!", 1500);
            } else {
              throw new Error("Gagal mengambil data dari server.");
            }
          } catch (error) {
            console.error("Error fetching data:", error);
            showToast(
              "Gagal terhubung ke server. Periksa koneksi atau URL Apps Script.",
              3000
            );
          } finally {
            hideLoading();
          }
        }

        // Fungsi untuk mengisi dropdown filter dengan nilai unik
        function populateFilterDropdown(data, filterId, fieldName) {
          const dropdown = document.getElementById(filterId);
          const uniqueValues = [
            ...new Set(
              data.map((item) => item[fieldName]).filter((value) => value)
            ),
          ];

          dropdown.innerHTML =
            '<option value="">All ' + fieldName + "</option>";
          uniqueValues.forEach((value) => {
            const option = document.createElement("option");
            option.value = value;
            option.textContent = value;
            dropdown.appendChild(option);
          });
        }

        // Fungsi untuk menghitung persentase kelengkapan data
        function calculateAchievement(item) {
          const fields = Object.values(employeeFormFields).flat();
          const totalFields = fields.length;
          let filledFields = 0;
          fields.forEach((field) => {
            if (item[field.key] && item[field.key] !== "") {
              filledFields++;
            }
          });
          return Math.round((filledFields / totalFields) * 100);
        }

        // Fungsi untuk merender tabel
        function renderTable(data, headers, page, searchQuery = "") {
          tableHeader.innerHTML = "";
          tableBody.innerHTML = "";

          // Render header
          let headerHtml =
            '<tr><th scope="col" class="p-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider rounded-tl-xl"><input type="checkbox" class="rounded text-indigo-600 focus:ring-indigo-500"></th>';
          headers.forEach((header) => {
            headerHtml += `<th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">${header.label}</th>`;
          });
          headerHtml += `<th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider rounded-tr-xl">Actions</th></tr>`;
          tableHeader.innerHTML = headerHtml;

          // Filter data berdasarkan pencarian dan dropdown
          const filteredData = data.filter((item) => {
            const matchesSearch = Object.values(item).some((value) =>
              String(value).toLowerCase().includes(searchQuery.toLowerCase())
            );

            const matchesDepartment =
              !filterDepartment.value ||
              item["DEPARTMENT"] === filterDepartment.value;
            const matchesSection =
              !filterSection.value || item["SECTION"] === filterSection.value;
            const matchesGrade =
              !filterGrade.value || item["GRADE"] === filterGrade.value;
            const matchesPohStatus =
              !filterPohStatus.value ||
              item["STATUS POH"] === filterPohStatus.value;

            return (
              matchesSearch &&
              matchesDepartment &&
              matchesSection &&
              matchesGrade &&
              matchesPohStatus
            );
          });

          // Terapkan pagination
          const startIndex = (page - 1) * itemsPerPage;
          const paginatedData = filteredData.slice(
            startIndex,
            startIndex + itemsPerPage
          );

          // Render body
          if (paginatedData.length === 0) {
            tableBody.innerHTML = `<tr><td colspan="${
              headers.length + 2
            }" class="text-center py-8 text-gray-500">Tidak ada data ditemukan.</td></tr>`;
          } else {
            paginatedData.forEach((item) => {
              let rowHtml = `<tr class="hover:bg-gray-100 cursor-pointer transition-colors duration-200" data-id="${item.id}">`;
              rowHtml += `<td class="p-4 whitespace-nowrap"><input type="checkbox" class="rounded text-indigo-600 focus:ring-indigo-500"></td>`;

              headers.forEach((header) => {
                let cellValue = item[header.key] || "-";
                if (header.key === "STATUS") {
                  let statusColor = "bg-gray-200 text-gray-800";
                  if (cellValue === "Active") {
                    statusColor = "bg-green-100 text-green-800";
                  } else if (cellValue === "Inactive") {
                    statusColor = "bg-red-100 text-red-800";
                  } else if (cellValue === "Onboarding") {
                    statusColor = "bg-yellow-100 text-yellow-800";
                  }
                  cellValue = `<span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${statusColor}">${cellValue}</span>`;
                } else if (header.key.includes("DATE")) {
                  // Menampilkan tanggal dalam format dd-mm-yyyy
                  if (cellValue !== "-") {
                    const date = new Date(cellValue);
                    const day = String(date.getDate()).padStart(2, "0");
                    const month = String(date.getMonth() + 1).padStart(2, "0");
                    const year = date.getFullYear();
                    cellValue = `${day}-${month}-${year}`;
                  }
                } else if (header.key === "ACHIEVEMENT") {
                  const achievement = calculateAchievement(item);
                  let barColor = "bg-red-500";
                  if (achievement > 90) {
                    barColor = "bg-green-500";
                  } else if (achievement > 60) {
                    barColor = "bg-blue-500";
                  } else if (achievement > 30) {
                    barColor = "bg-yellow-500";
                  }

                  cellValue = `<div class="w-full bg-gray-200 rounded-full h-2.5">
                                                <div class="${barColor} h-2.5 rounded-full" style="width: ${achievement}%"></div>
                                              </div>
                                              <div class="text-xs text-center mt-1">${achievement}%</div>`;
                }

                rowHtml += `<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${cellValue}</td>`;
              });

              // Tombol aksi
              rowHtml += `<td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                                        <button class="text-indigo-600 hover:text-indigo-900 mx-1 edit-btn transition-colors duration-200" data-id="${item.id}" onclick="event.stopPropagation(); showModal('edit', ${item.id})">
                                            <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path></svg>
                                        </button>
                                        <button class="text-red-600 hover:text-red-900 mx-1 delete-btn transition-colors duration-200" data-id="${item.id}" onclick="event.stopPropagation(); deleteItem(${item.id})">
                                            <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                                        </button>
                                    </td>`;
              rowHtml += `</tr>`;
              tableBody.innerHTML += rowHtml;
            });
          }

          // Tambahkan event listener untuk detail view
          tableBody.querySelectorAll("tr").forEach((row) => {
            row.addEventListener("click", () => {
              const itemId = parseInt(row.dataset.id);
              showModal("edit", itemId);
            });
          });

          renderPagination(filteredData.length);
        }

        // Fungsi untuk merender pagination
        function renderPagination(totalItems) {
          const totalPages = Math.ceil(totalItems / itemsPerPage);
          const paginationContainer = document.getElementById("pagination");
          paginationContainer.innerHTML = "";

          if (totalItems > 0) {
            let paginationHtml = `<span class="text-sm text-gray-500">${totalItems} records</span>
                                            <div class="flex items-center space-x-2">`;

            // Tombol sebelumnya
            paginationHtml += `<button onclick="changePage(${
              currentPage - 1
            })" class="bg-gray-200 text-gray-600 px-3 py-1 rounded-lg text-sm hover:bg-gray-300 disabled:opacity-50 disabled:cursor-not-allowed" ${
              currentPage === 1 ? "disabled" : ""
            }><</button>`;

            // Tombol halaman
            for (let i = 1; i <= totalPages; i++) {
              paginationHtml += `<button onclick="changePage(${i})" class="px-3 py-1 rounded-lg text-sm transition-colors duration-200 ${
                currentPage === i
                  ? "bg-indigo-500 text-white"
                  : "bg-gray-200 text-gray-600 hover:bg-gray-300"
              }">${i}</button>`;
            }

            // Tombol selanjutnya
            paginationHtml += `<button onclick="changePage(${
              currentPage + 1
            })" class="bg-gray-200 text-gray-600 px-3 py-1 rounded-lg text-sm hover:bg-gray-300 disabled:opacity-50 disabled:cursor-not-allowed" ${
              currentPage === totalPages ? "disabled" : ""
            }>></button>`;

            paginationHtml += `</div>`;
            paginationContainer.innerHTML = paginationHtml;
          }
        }

        function changePage(page) {
          if (
            page > 0 &&
            page <= Math.ceil(getCurrentData().length / itemsPerPage)
          ) {
            currentPage = page;
            render();
          }
        }

        // Fungsi untuk membuat form HTML
        function generateFormHtml(fields, data) {
          let formHtml = "";
          for (const section in fields) {
            formHtml += `<div class="form-section">`;
            formHtml += `<h4 class="text-lg font-semibold text-gray-800 mb-4">${section}</h4>`;
            formHtml += `<div class="grid grid-cols-1 md:grid-cols-2 gap-4">`;
            fields[section].forEach((field) => {
              const value = data ? data[field.key] || "" : "";
              let inputHtml;
              if (field.type === "select") {
                let optionsHtml = field.options
                  .map(
                    (option) =>
                      `<option value="${option}" ${
                        value === option ? "selected" : ""
                      }>${option}</option>`
                  )
                  .join("");
                inputHtml = `<select name="${field.key}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2 bg-gray-50">${optionsHtml}</select>`;
              } else {
                // Mengubah format tanggal untuk tampilan di form
                let inputValue = value;
                if (field.type === "date" && value && value.includes("-")) {
                  inputValue = value;
                } else if (field.type === "date" && value) {
                  const date = new Date(value);
                  const month = String(date.getMonth() + 1).padStart(2, "0");
                  const day = String(date.getDate()).padStart(2, "0");
                  const year = date.getFullYear();
                  inputValue = `${year}-${month}-${day}`;
                }

                inputHtml = `<input type="${field.type}" name="${field.key}" value="${inputValue}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2 bg-gray-50" required>`;
              }

              formHtml += `
                            <div class="flex flex-col">
                                <label class="text-sm font-medium text-gray-700">${field.label}</label>
                                ${inputHtml}
                            </div>
                        `;
            });
            formHtml += `</div></div>`;
          }
          return formHtml;
        }

        // Fungsi untuk menampilkan log perubahan
        function renderChangesLog() {
          changesList.innerHTML = "";
          const changes = [];

          const formData = new FormData(dataForm);
          const currentData = {};
          for (let [key, value] of formData.entries()) {
            currentData[key] = value;
          }

          const fields =
            currentView === "employee" ? employeeFormFields : familyFormFields;

          // flatten fields to easily access
          const flatFields = {};
          for (const section in fields) {
            fields[section].forEach((field) => {
              flatFields[field.key] = field;
            });
          }

          for (const key in currentData) {
            const originalValue = originalItem[key] || "";
            const currentValue = currentData[key] || "";

            // Handle date values for comparison
            let comparisonOriginal = originalValue;
            let comparisonCurrent = currentValue;

            if (flatFields[key] && flatFields[key].type === "date") {
              // Normalize date format for comparison
              comparisonOriginal = new Date(originalValue)
                .toISOString()
                .split("T")[0];
              comparisonCurrent = new Date(currentValue)
                .toISOString()
                .split("T")[0];
            }

            if (comparisonOriginal !== comparisonCurrent && flatFields[key]) {
              changes.push({
                field: flatFields[key].label,
                oldValue: originalValue,
                newValue: currentValue,
              });
            }
          }

          if (changes.length > 0) {
            changes.forEach((change) => {
              const li = document.createElement("li");
              li.innerHTML = `<span class="font-semibold">${change.field}</span>: dari "${change.oldValue}" menjadi "${change.newValue}"`;
              changesList.appendChild(li);
            });
            changesLog.classList.remove("hidden");
          } else {
            changesLog.classList.add("hidden");
          }
        }

        // Fungsi untuk menampilkan modal detail/edit
        function showModal(mode, id = null) {
          dataForm.innerHTML = "";
          changesLog.classList.add("hidden");

          const data = (currentView === "employee" ? employees : families).find(
            (e) => e.id === id
          );
          if (data) {
            originalItem = { ...data }; // Simpan salinan data asli
          } else {
            originalItem = {};
          }

          let fields =
            currentView === "employee" ? employeeFormFields : familyFormFields;

          modalTitle.textContent =
            mode === "add"
              ? `Tambah ${
                  currentView === "employee"
                    ? "Karyawan Baru"
                    : "Anggota Keluarga"
                }`
              : `Edit Data ${data ? data.NAME : ""}`;

          saveFormBtn.textContent = "Simpan Perubahan";
          saveFormBtn.dataset.mode = mode;
          saveFormBtn.dataset.id = id;

          // Generate form HTML
          dataForm.innerHTML = generateFormHtml(fields, data);

          // Tambahkan event listener untuk memantau perubahan
          dataForm.addEventListener("input", renderChangesLog);

          // Tampilkan tombol simpan dan batal
          saveFormBtn.classList.remove("hidden");
          cancelFormBtn.classList.remove("hidden");

          dataModal.classList.add("is-active");
          dataModal.classList.remove("hidden");
        }

        // Fungsi untuk menutup modal
        function closeModal() {
          dataModal.classList.remove("is-active");
          dataModal.classList.add("hidden");
          dataForm.reset();
        }

        // Fungsi untuk menampilkan modal achievement
        function showAchievementModal() {
          achievementList.innerHTML = "";
          const employeeData = employees.map((emp) => ({
            name: emp.NAME,
            achievement: calculateAchievement(emp),
          }));

          employeeData.forEach((item) => {
            const achievementColor =
              item.achievement === 100 ? "bg-green-500" : "bg-red-500";
            const achievementItem = document.createElement("div");
            achievementItem.className =
              "flex items-center justify-between mb-2";
            achievementItem.innerHTML = `
                        <span class="font-semibold">${item.name}</span>
                        <span class="px-2 py-1 text-white rounded-full ${achievementColor}">${item.achievement}%</span>
                    `;
            achievementList.appendChild(achievementItem);
          });

          achievementModal.classList.add("is-active");
          achievementModal.classList.remove("hidden");
        }

        // Fungsi untuk menutup modal achievement
        function closeAchievementModal() {
          achievementModal.classList.remove("is-active");
          achievementModal.classList.add("hidden");
        }

        // Fungsi untuk menghapus item
        async function deleteItem(id) {
          if (confirm("Apakah Anda yakin ingin menghapus data ini?")) {
            showLoading();
            const sheetName =
              currentView === "employee" ? "DATA_KARYAWAN" : "DATA_KELUARGA";
            try {
              const response = await handleApiRequest({
                action: "delete",
                sheet: sheetName,
                id: id,
              });
              if (response && response.status === "success") {
                showToast("Data berhasil dihapus!");
              } else {
                showToast("Gagal menghapus data.");
              }
              render();
            } catch (error) {
              console.error("Error deleting data:", error);
              showToast("Gagal menghapus data.");
              hideLoading();
            }
          }
        }

        // Fungsi untuk menyimpan data dari form
        async function saveForm(event) {
          event.preventDefault();

          const inputs = dataForm.querySelectorAll("input, select");
          let isValid = true;
          inputs.forEach((input) => {
            if (input.hasAttribute("required") && !input.value) {
              isValid = false;
            }
          });

          if (!isValid) {
            alert("Silakan lengkapi semua field yang diperlukan.");
            return;
          }

          const formData = new FormData(dataForm);
          const newItem = {};
          for (let [key, value] of formData.entries()) {
            newItem[key] = value;
          }

          const mode = saveFormBtn.dataset.mode;
          const id = parseInt(saveFormBtn.dataset.id);
          const sheetName =
            currentView === "employee" ? "DATA_KARYAWAN" : "DATA_KELUARGA";

          showLoading();
          try {
            const payload = {
              action: mode,
              sheet: sheetName,
              id: mode === "edit" ? id : null,
              data: newItem,
            };
            const response = await handleApiRequest(payload);
            if (response && response.status === "success") {
              closeModal();
              showToast(
                `Data berhasil di${mode === "add" ? "tambah" : "perbarui"}!`
              );
              render();
            } else {
              showToast("Gagal menyimpan data.");
            }
          } catch (error) {
            console.error("Error saving data:", error);
            showToast("Gagal menyimpan data.");
            hideLoading();
          }
        }

        // Mengirim request ke Apps Script API
        async function handleApiRequest(payload) {
          const response = await fetch(SCRIPT_URL, {
            method: "POST",
            body: JSON.stringify(payload),
            headers: { "Content-Type": "application/json" },
          });
          return response.json();
        }

        // Fungsi untuk mengunduh data sebagai CSV
        function exportToCsv() {
          const dataToExport = getCurrentData();
          if (dataToExport.length === 0) {
            alert("Tidak ada data untuk diekspor.");
            return;
          }
          const headers = Object.keys(dataToExport[0] || {});
          const csv = [
            headers.join(","),
            ...dataToExport.map((row) =>
              headers
                .map(
                  (header) =>
                    `"${(row[header] || "").toString().replace(/"/g, '""')}"`
                )
                .join(",")
            ),
          ].join("\n");

          const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
          const link = document.createElement("a");
          link.href = URL.createObjectURL(blob);
          link.download = `${currentView}_data.csv`;
          link.click();
        }

        // Fungsi untuk mengimpor data (simulasi)
        function importData() {
          alert(
            "Fungsi impor adalah placeholder. Dalam aplikasi nyata, Anda akan menangani unggahan file dan parsing data di sini."
          );
        }

        // Fungsi untuk mendapatkan data saat ini berdasarkan view
        function getCurrentData() {
          return currentView === "employee" ? employees : families;
        }

        // Fungsi render utama
        async function render() {
          if (currentView === "employee") {
            pageTitle.textContent = "Employee List";
            addItemBtn.textContent = "Add Employee";

            await fetchData("DATA_KARYAWAN");
            populateFilterDropdown(
              employees,
              "filter-department",
              "DEPARTMENT"
            );
            populateFilterDropdown(employees, "filter-section", "SECTION");
            populateFilterDropdown(employees, "filter-grade", "GRADE");
            populateFilterDropdown(
              employees,
              "filter-poh-status",
              "STATUS POH"
            );

            renderTable(
              employees,
              employeeHeaders,
              currentPage,
              searchInput.value
            );
          } else {
            pageTitle.textContent = "Family List";
            addItemBtn.textContent = "Add Family Member";

            await fetchData("DATA_KELUARGA");

            // Kosongkan filter dropdown untuk tabel keluarga
            filterDepartment.innerHTML =
              '<option value="">All Department</option>';
            filterSection.innerHTML = '<option value="">All Section</option>';
            filterGrade.innerHTML = '<option value="">All Grade</option>';
            filterPohStatus.innerHTML =
              '<option value="">All POH Status</option>';

            renderTable(
              families,
              familyHeaders,
              currentPage,
              searchInput.value
            );
          }
        }

        // Event Listeners
        tabEmployee.addEventListener("click", () => {
          currentView = "employee";
          tabEmployee.classList.add(
            "border-indigo-500",
            "text-indigo-600",
            "font-semibold"
          );
          tabEmployee.classList.remove("border-transparent", "text-gray-500");
          tabFamily.classList.add("border-transparent", "text-gray-500");
          tabFamily.classList.remove(
            "border-indigo-500",
            "text-indigo-600",
            "font-semibold"
          );
          render();
        });

        tabFamily.addEventListener("click", () => {
          currentView = "family";
          tabFamily.classList.add(
            "border-indigo-500",
            "text-indigo-600",
            "font-semibold"
          );
          tabFamily.classList.remove("border-transparent", "text-gray-500");
          tabEmployee.classList.add("border-transparent", "text-gray-500");
          tabEmployee.classList.remove(
            "border-indigo-500",
            "text-indigo-600",
            "font-semibold"
          );
          render();
        });

        addItemBtn.addEventListener("click", () => showModal("add"));
        closeModalBtn.addEventListener("click", closeModal);
        cancelFormBtn.addEventListener("click", closeModal);
        dataForm.addEventListener("submit", saveForm);
        searchInput.addEventListener("input", () => {
          currentPage = 1;
          render();
        });
        exportBtn.addEventListener("click", exportToCsv);
        importBtn.addEventListener("click", importData);
        achievementBtn.addEventListener("click", showAchievementModal);
        closeAchievementModalBtn.addEventListener(
          "click",
          closeAchievementModal
        );

        // Event listener untuk filter dropdown
        filterDepartment.addEventListener("change", () => {
          currentPage = 1;
          render();
        });
        filterSection.addEventListener("change", () => {
          currentPage = 1;
          render();
        });
        filterGrade.addEventListener("change", () => {
          currentPage = 1;
          render();
        });
        filterPohStatus.addEventListener("change", () => {
          currentPage = 1;
          render();
        });

        // Render pertama kali saat halaman dimuat
        document.addEventListener("DOMContentLoaded", () => {
          render();
        });
      })();
    </script>
  </body>
</html>
